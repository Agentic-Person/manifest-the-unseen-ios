---
task_id: TASK-2025-11-002
title: "Supabase Project Setup and Configuration"
workstream: authentication
phase: "Pre-Development - Infrastructure Setup"
week: 1
status: active
priority: P0
assigned_agent: backend-specialist
estimated_hours: 4
actual_hours:
created: 2025-11-17
updated: 2025-11-17
completed:
---

## Objective
Set up Supabase project with authentication providers, create initial database schema, and establish connection from local development environment.

## Context
**Why this task is important**:
- Supabase is the backend foundation for the entire app (auth, database, storage, realtime)
- Must be configured before any feature development can begin
- RLS policies are critical for data security

**Related documentation**:
- PRD Section 4.2: Tech Stack (Supabase backend)
- TDD Section 6: Authentication Architecture
- TDD Section 3: Database Schema
- CLAUDE.md: "Why Supabase" section

**Prerequisite knowledge**:
- Supabase project structure
- PostgreSQL basics
- Row Level Security (RLS)
- Supabase CLI usage

## Acceptance Criteria
What must be true for this task to be considered complete:

- [ ] **Functional**: Supabase project created and accessible
- [ ] **Database**: Users table created with RLS policies enabled
- [ ] **Auth**: Apple Sign-In and email/password providers configured
- [ ] **CLI**: Supabase CLI installed and connected to project
- [ ] **Connection**: Successfully tested connection from local machine
- [ ] **Documentation**: `.env.example` created with required variables
- [ ] **Security**: API keys documented securely (not committed to git)

## Implementation Steps
Detailed breakdown of how to complete this task:

1. **Create Supabase Project** (1h)
   - Go to supabase.com, create account
   - Create new project: "manifest-the-unseen"
   - Choose region (US East for lower latency)
   - Note project URL and anon key
   - Note service_role key (for admin operations)

2. **Configure Authentication Providers** (1h)
   - Enable Apple Sign-In in Supabase dashboard
   - Enable Email/Password authentication
   - Configure redirect URLs for development
   - Set up email templates (welcome, password reset)
   - Document redirect URL patterns

3. **Create Initial Database Schema** (1.5h)
   - Install Supabase CLI: `npm install -g supabase`
   - Initialize Supabase locally: `npx supabase init`
   - Create users table with RLS:
     ```sql
     CREATE TABLE users (
       id UUID PRIMARY KEY REFERENCES auth.users(id),
       email TEXT UNIQUE,
       full_name TEXT,
       avatar_url TEXT,
       subscription_tier TEXT DEFAULT 'free',
       trial_end_date TIMESTAMP WITH TIME ZONE,
       created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
       updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
     );

     -- Enable RLS
     ALTER TABLE users ENABLE ROW LEVEL SECURITY;

     -- RLS Policy: Users can only see their own data
     CREATE POLICY "Users can view own data" ON users
       FOR SELECT USING (auth.uid() = id);

     CREATE POLICY "Users can update own data" ON users
       FOR UPDATE USING (auth.uid() = id);
     ```
   - Push schema to Supabase: `npx supabase db push`

4. **Test Connection** (0.5h)
   - Install Supabase JS client locally: `npm install @supabase/supabase-js`
   - Create simple test script to verify connection
   - Test auth signup/login
   - Test database query with RLS

5. **Documentation** (0.5h)
   - Create `.env.example` with required variables:
     ```
     SUPABASE_URL=your_project_url
     SUPABASE_ANON_KEY=your_anon_key
     SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
     ```
   - Document setup steps in `docs/setup-guide.md`
   - Add Supabase project details to secure password manager

## Dependencies
**Blocks**:
- TASK-003: React Native initialization (needs Supabase URL/keys)
- TASK-005: Core dependencies installation (needs Supabase SDK)

**Blocked By**:
- None (this is the starting point)

**Related Tasks**:
- TASK-003: React Native Project Initialization

## Resources
**Documentation**:
- https://supabase.com/docs/guides/getting-started
- https://supabase.com/docs/guides/auth
- https://supabase.com/docs/guides/database/postgres/row-level-security
- https://supabase.com/docs/guides/cli

**Internal resources**:
- TDD Section 6: Authentication
- TDD Section 3: Database Schema
- CLAUDE.md: Supabase setup guidance

## Agent Instructions
**Recommended agent**: Backend Specialist

**Specific guidance for this task**:
- Use the Backend Specialist system prompt: `prompts/system-prompts/backend-specialist.md`
- Follow PostgreSQL best practices for schema design
- **CRITICAL**: Enable RLS on ALL tables containing user data
- Use UUID for primary keys (Supabase auth.users uses UUID)
- Set up database triggers for `updated_at` timestamps

**Technical constraints**:
- Must support iOS (Supabase JS client works with React Native)
- Must use RLS for security (no server-side auth checks in app)
- Must handle offline scenarios (local caching strategy TBD)

## Review Checklist
Before marking complete, ensure:

- [ ] **Supabase Project**: Accessible from dashboard
- [ ] **Authentication**: Apple Sign-In and email/password enabled
- [ ] **Database**: Users table created with RLS policies
- [ ] **CLI**: Supabase CLI installed and working
- [ ] **Connection Test**: Successfully connected from local machine
- [ ] **Documentation**: Setup steps documented
- [ ] **Security**: API keys not committed to git
- [ ] **Ready for Integration**: Can proceed to React Native setup

## Progress Notes
**[2025-11-17] - Orchestrator**:
- Task created for Day 2 (Week 1)
- Assigned to Backend Specialist
- Priority: P0 (blocks all other tasks)

## Final Notes
This is the foundation task for the entire project. Take time to set up properly - mistakes here will be costly to fix later.
